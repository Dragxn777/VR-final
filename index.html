<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v$npm_package_version/dist/aframe-physics-system.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/kylebakerio/ada-water/ada-water.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" rel="stylesheet">


</head>

<body>
  <a-scene fog="type: exponential; color: #ff0000; density: 0.002">
    <a-assets>
      <a-asset-item id="FantasyHouse" src="./assets/FantasyHouse.glb"></a-asset-item>

      <img id="stars" src="./assets/sky_16_2k.png" alt=>
      <a-asset-item id="wall2" src="./assets/mur2.glb"></a-asset-item>
      <a-asset-item id="wall" src="./assets/mur.glb"></a-asset-item>
      <a-asset-item id="bolt" src="./assets/bolt.glb"></a-asset-item>
      <a-asset-item id="sword" src="./assets/sword.glb"></a-asset-item>
      <a-asset-item id="house1" src="./assets/medieval1.glb"></a-asset-item>
      <a-asset-item id="house2" src="./assets/medieval2.glb"></a-asset-item>
      <a-asset-item id="house3" src="./assets/medieval3.glb"></a-asset-item>
      <a-asset-item id="house4" src="./assets/medieval4.glb"></a-asset-item>
      <a-asset-item id="house5" src="./assets/medieval5.glb"></a-asset-item>
      <a-asset-item id="path" src="./assets/Path.glb"></a-asset-item>
      <a-asset-item id="mainpath" src="./assets/mainpath.glb"></a-asset-item>
      <a-asset-item id="secondpath" src="./assets/secondpath.glb"></a-asset-item>
      <a-asset-item id="thirdpath" src="./assets/thirdpath.glb"></a-asset-item>
      <a-asset-item id="fence" src="./assets/fence.glb"></a-asset-item>
      <a-asset-item id="colossal" src="./assets/colossal_titan.glb"></a-asset-item>
      <a-asset-item id="rock" src="./assets/rock.glb"></a-asset-item>
      <a-asset-item id="man" src="./assets/Man.glb"></a-asset-item>
      <a-asset-item id="titan" src="./assets/titan.glb"></a-asset-item>
      <a-asset-item id="beast" src="./assets/beast_titan.glb"></a-asset-item>

      <img id="road" src="./assets/ground.png"></img>
      <img id="map" src="./assets/normalmap.png"></img>
      <img id="stone" src="./assets/stone.png" alt="">
      <img id="#smoke" src="./assets/Smoke.H14.2k.png" alt="">
    </a-assets>

    <!-- Caméra + sabres -->

    <a-entity id="rig" movement-controls position="0 0 -8" kinematic-body foo>
      <!-- Caméra attachée au rig -->
      <a-entity camera look-controls wasd-controls="fly: true; acceleration: 150;" position="0 1.6 -8"></a-entity>

      <a-sound src="src: url(./assets/music2.mp3)" autoplay="true" loop="true" volume="1"></a-sound>

      <a-text id="villager-counter" target="#rig" value="Villageois secourus : 0 / 12" position="1 0.8 -1"
        rotation="0 -45 0"></a-text>
      <a-text id="counter" target="#rig" value="Titans abbatus : 0 / 8" position="1 0.5 -1" rotation="0 -45 0"></a-text>


      <a-entity oculus-touch-controls="hand: left" laser-controls="hand: left" raycaster="objects: .clickable; far: 20; lineOpacity: 0; showLine: false;" rotation="0 45 0">
        <a-entity gltf-model="#sword" position="0 0 0" rotation="-40 0 90" target="#rig"
          scale="0.0012 0.0012 0.0012"></a-entity>
      </a-entity>

      <a-entity oculus-touch-controls="hand: right" laser-controls="hand: right" raycaster="objects: .clickable; far: 20; lineOpacity: 0; showLine: false;">
        <a-entity gltf-model="#sword" position="0 0 0" rotation="-40 0 90" target="#rig"
          scale="0.0012 0.0012 0.0012"></a-entity>
      </a-entity>
    </a-entity>

    <!-- Terrain -->
    <a-entity>
      <a-plane position="0 0 0" width="800" height="800" repeat="300 300" rotation="-90 0 0" roughness="1" static-body
        material="src: #road"></a-plane>
      <a-entity gltf-model="#wall" position="0 -1 15" scale="6 12 6"></a-entity>
      <a-entity gltf-model="#wall2" position="0 -1 160" scale="6 12 6"></a-entity>
      <a-entity gltf-model="#bolt" position="0 15 -325" scale="45 45 45"
        shadow="cast: false; receive: true;"></a-entity>
    </a-entity>


    <!-- Maisons gauche -->
    <a-entity>
      <a-entity gltf-model="#house1" position="-10 0 -12" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house2" position="-10 0 -30" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house3" position="-10 0 -50" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="-10 0 -75" scale="3.5 3.5 3.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#house1" position="-25 0 -75" scale="3.5 3.5 3.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#house1" position="-40 0 -75" scale="3.5 3.5 3.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#house2" position="-40 0 -20" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="-40 0 -40" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house3" position="-10 0 -100" scale="5.5 5.5 5.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#house2" position="-40 0 -100" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="-40 0 -120" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="-20 0 -130" scale="5.5 5.5 5.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#house2" position="-20 0 -150" scale="4.5 4.5 4.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#rock" position="-43 0 -143" scale="7.5 7.5 7.5" rotation="0 90 0"></a-entity>

    </a-entity>

    <!-- Maisons droite -->

    <a-entity>
      <a-entity gltf-model="#house3" position="10 0 -50" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="10 0 -15" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="40 0 -25" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house3" position="65 0 -45" scale="6.5 6.5 6.5" rotation="0 -90 0"></a-entity>
      <a-entity gltf-model="#house1" position="65 0 -95" scale="6.5 6.5 6.5" rotation="0 -90 0"></a-entity>
      <a-entity gltf-model="#house1" position="10 0 -95" scale="3.5 3.5 3.5" rotation="0 -90 0"></a-entity>
      <a-entity gltf-model="#house3" position="15 0 -145" scale="5.5 5.5 5.5" rotation="0 -90 0"></a-entity>
      <a-entity gltf-model="#house2" position="10 0 -28" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#rock" position="30 0 -68" scale="8 8 8" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="10 0 -75" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="55 0 -75" scale="3.5 3.5 3.5" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#house2" position="40 0 -20" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="40 0 -40" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house2" position="40 0 -100" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="20 0 -120" scale="3.5 3.5 3.5" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#house1" position="40 0 -130" scale="5.5 5.5 5.5" rotation="0 0 0"></a-entity>
    </a-entity>

    <a-entity gltf-model="#colossal" position="0 0 -248" scale="7 7 7" rotation="40 0 0"></a-entity>
    <a-image src="./assets/Smoke.H14.2k.png" position="0 100 -200" scale="200 200 200" rotation="0 0 0"></a-image>

    <!-- Chemin gauche-->
    <a-entity>
      <a-entity gltf-model="#mainpath" position="-0 0 -6" scale="2 2 2" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#path" position="-3 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-3 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-6 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-6 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-9 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-9 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-12 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-12 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-15 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-15 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-18 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-18 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-21 0 -20" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#path" position="-21 0 -23" scale="2 2 2"></a-entity>
      <a-entity gltf-model="#mainpath" position="-24 0 105" scale="2 2 2" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#secondpath" position="-56.8 0 -60" scale="1.8 1.8 1.8" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#secondpath" position="-56.8 0 -86" scale="1.8 1.8 1.8" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#thirdpath" position="-22.8 0 -113.5" scale="1.8 1.8 1.8" rotation="0 0 0"></a-entity>

    </a-entity>

    <!-- Chemin droite-->
    <a-entity>
      <a-entity gltf-model="#thirdpath" position="3.8 0 -110" scale="1.8 1.8 1.8" rotation="0 0 0"></a-entity>
      <a-entity gltf-model="#thirdpath" position="26.25 0 -83.5" scale="1.8 1.8 1.8" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#thirdpath" position="26.25 0 -83.5" scale="1.8 1.8 1.8" rotation="0 0 0"></a-entity>



    </a-entity>

    <!-- Titans -->
    <a-entity>
      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.02 0.02 0.02" rotation="0 0 0"
        position="0 0 -20">
        <a-entity class="glow" geometry="primitive: sphere; radius: 26;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.04 0.04 0.04" rotation="0 35 0"
        position="-35 0 -55">
        <a-entity class="glow" geometry="primitive: sphere; radius: 30;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.04 0.04 0.04" rotation="0 48 0"
        position="20 0 -40">
        <a-entity class="glow" geometry="primitive: sphere; radius: 30;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.06 0.06 0.06" rotation="0 -50 0"
        position="50 0 -25">
        <a-entity class="glow" geometry="primitive: sphere; radius: 31;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.03 0.03 0.03" rotation="0 90 0"
        position="75 0 -75">
        <a-entity class="glow" geometry="primitive: sphere; radius: 28;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.08 0.08 0.08" rotation="0 -90 0"
        position="70 0 -120">
        <a-entity class="glow" geometry="primitive: sphere; radius: 30;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.05 0.05 0.05" rotation="0 90 0"
        position="-10 0 -88">
        <a-entity class="glow" geometry="primitive: sphere; radius: 30;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>

      <a-entity class="clickable" cursor-listener gltf-model="#beast" scale="0.1 0.1 0.1" rotation="0 -28 0"
        position="26 0 -110">
        <a-entity class="glow" geometry="primitive: sphere; radius: 32;"
          material="shader: standard; color: #ff0000; opacity: 0.4; transparent: true; emissive: #ff0000; emissiveIntensity: 1.5;"
          position="0 200 0">
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Villageois -->
    <a-entity>
      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 0 0"
        position="0 0 -15">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 90 0"
        position="-10 0 -12">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 -90 0"
        position="11 0 -14">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 -90 0"
        position="38 0 -42">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 -45 0"
        position="30 0 -48">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 45 0"
        position="16 0 -55">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 26 0"
        position="-22 0 -27">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 0 0"
        position="-24 0 -75">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 0 0"
        position="-12 0 -75">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 0 0"
        position="-40 0 -75">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 -65 0"
        position="26 0 -85">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>

      <a-entity class="clickable" villager-listener gltf-model="#man" scale="0.5 0.5 0.5" rotation="-90 65 0"
        position="-38 0 -85">
        <a-entity class="glow" geometry="primitive: sphere; radius: 0.8;"
          material="shader: standard; color: limegreen; opacity: 0.4; emissive: limegreen;" position="0 3 0"></a-entity>
      </a-entity>
    </a-entity>

    <!-- Eau -->

    <a-water position="-70 0.11 -50" scale="1.5 20 1"></a-water>
    <a-entity gltf-model="#fence" position="-60 0 0" rotation="0 90 0"></a-entity>
    <a-entity gltf-model="#fence" position="-80 0 0" rotation="0 90 0"></a-entity>

    <!-- Lumières -->
    <a-light type="ambient" color="#ff0000" intensity="1.5"></a-light>
    <a-light type="directional" position="0 5 -22" color="#ffffff" intensity="0.7"></a-light>
    <a-light type="directional" position="0 5 35" color="#ffffff" intensity="1.7"></a-light>


    <a-sky src="#stars"></a-sky>
    </a-entity>
  </a-scene>

  <script>
    // Variable globale pour stocker le compteur
    let globalCounter = 0;
    let villagerCounter = 0; // Compteur pour les villageois


    AFRAME.registerComponent("cursor-listener", {
      init: function () {
        // Sélectionne l'élément du compteur
        let counterElement = document.querySelector("#counter");

        // Gère l'événement de clic
        this.el.addEventListener("click", function (evt) {
          // Animation du personnage (si nécessaire)
          evt.target.setAttribute("animation__001", {
            property: "rotation",
            to: { x: -90, y: 0, z: 0 },
          });

          // Sélectionne la sphère (enfant avec la classe "glow") et la rend invisible
          let glow = evt.target.querySelector(".glow");
          if (glow) {
            glow.setAttribute("visible", false); // Cache la sphère
          }

          // Incrémente le compteur global
          globalCounter++;
          counterElement.setAttribute("value", "Titans abattus : " + globalCounter + " / 8");
        });
      },
    });

    // Composant pour les villageois
    AFRAME.registerComponent("villager-listener", {
      init: function () {
        // Sélectionne l'élément du compteur des villageois
        let villagerCounterElement = document.querySelector("#villager-counter");

        // Gère l'événement de clic
        this.el.addEventListener("click", function (evt) {
          // Animation du villageois (si nécessaire)
          evt.target.setAttribute("animation__001", {
            property: "rotation",
            to: { x: 0, y: 0, z: 0 },
          });

          // Sélectionne la sphère (enfant avec la classe "glow") et la rend invisible
          let glow = evt.target.querySelector(".glow");
          if (glow) {
            glow.setAttribute("visible", false); // Cache la sphère
          }

          // Incrémente le compteur des villageois
          villagerCounter++;
          villagerCounterElement.setAttribute("value", "Villageois secourus : " + villagerCounter + " / 12");
        });
      },
    });


  </script>

</body>

</html>